<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-1 (1.69)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Writing a Datalog Analysis</TITLE>
<META NAME="description" CONTENT="Writing a Datalog Analysis">
<META NAME="keywords" CONTENT="user_guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="user_guide.css">

<LINK REL="next" HREF="node10.html">
<LINK REL="previous" HREF="node8.html">
<LINK REL="up" HREF="user_guide.html">
<LINK REL="next" HREF="node10.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html140"
  HREF="node10.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html138"
  HREF="user_guide.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html132"
  HREF="node8.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html141"
  HREF="node10.html">Tuning a Datalog Analysis</A>
<B> Up:</B> <A NAME="tex2html139"
  HREF="user_guide.html">Chord: A Static and</A>
<B> Previous:</B> <A NAME="tex2html133"
  HREF="node8.html">Instrumentation Events</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00090000000000000000"></A>
<A NAME="sec:writing-datalog-analysis"></A>
<BR>
Writing a Datalog Analysis
</H1>

<P>
Chord interprets each file with extension <TT>.dlog</TT> or <TT>.datalog</TT> in the path specified by
property <TT>chord.dlog.analysis.path</TT> as a program analysis expressed in Datalog.
A Datalog analysis declares a bunch of input/output program relations,
each over one or more program domains, and provides a bunch of rules (constraints)
specifying how to compute the output relations from the input relations.
An example of such an analysis is as follows:

<P><PRE>
# name=datarace-dlog

# Program domains
.include "E.dom"
.include "F.dom"
.include "T.dom"

# BDD variable order
.bddvarorder E0xE1_T0_T1_F0

# Input/intermediate/output program relations
field(e:E0,f:F0) input
write(e:E0) input
reach(t:T0,e:E0) input
alias(e1:E0,e2:E1) input
escape(e:E0) input
unguarded(t1:T0,e1:E0,t2:T1,e2:E1) input
hasWrite(e1:E0,e2:E1)
candidate(e1:E0,e2:E1) 
datarace(t1:T0,e1:E0, t2:T1,e2:E1) output

# Analysis constraints
hasWrite(e1,e2) :- write(e1).
hasWrite(e1,e2) :- write(e2).
candidate(e1,e2) :- field(e1,f), field(e2,f), hasWrite(e1,e2), e1 &lt;= e2.
datarace(t1,e1,t2,e2) :- candidate(e1,e2), reach(t1,e1), reach(t2,e2), \
    alias(e1,e2), escape(e1), escape(e2), unguarded(t1,e1,t2,e2).
</PRE>

<P>
Any line that begins with a <TT>#</TT> is regarded a comment, except a
line of the form <TT>#</TT> <TT>name=&lt;...&gt;</TT>, which specifies the name
<TT>&lt;...&gt;</TT> of the Datalog analysis.
Each Datalog analysis is expected to have exactly one such line.
The above Datalog analysis is named <TT>datarace-dlog</TT>.
In Chord, all Datalog analysis names have suffix
<TT>-dlog</TT> and all Java analysis names have suffix <TT>-java</TT>, but
this is merely a convention that user-defined analyses are free to deviate from.
The name of each analysis, written in Datalog or in Java, is expected to be
unique across all analyses in scope (i.e., across all analyses in paths
specified by properties <TT>chord.dlog.analysis.path</TT> and <TT>chord.java.analysis.path</TT>).

<P>
The <TT>.include "&lt;...&gt;.dom"</TT> lines specify each program domain named
<TT>&lt;...&gt;</TT> that is needed by the Datalog analysis, i.e., each domain over which
any program relation that is input/output by the Datalog analysis is defined. 
The declaration of each such relation specifies the domain of each of the relation's attributes.
If the same domain appears in multiple attributes of a relation then
contiguous integers starting from 0 must be used to distinguish them; for instance,
in the above example, <TT>candidate</TT> is a binary relation, both of whose
attributes have domain E, and they are distinguished as E0 and E1.

<P>
Each relation is represented symbolically (as opposed to explicitly)
using a graph-based data structure called a Binary Decision Diagram (BDD for short).
Each domain containing N elements is assigned log2(N) BDD variables.
The size of a BDD and the efficiency of operations on it depends heavily
on the order of these BDD variables.
The <TT>.bddvarorder &lt;...&gt;</TT> line in the Datalog analysis enables the Datalog
analysis writer to specify this order.
It must list all domains along with their numerical suffixes, separated
by <TT>_</TT> or <TT>x</TT>.
Using a <TT>_</TT> between two domains, such as <TT>T0_T1</TT>, means that the BDD variables assigned
to domain <TT>T0</TT> precede those assigned to domain <TT>T1</TT> in the BDD variable
order for this Datalog analysis.
Using a <TT>x</TT> between two domains, such as <TT>E0xE1</TT>, means that the
BDD variables assigned to domains <TT>E0</TT> and <TT>E1</TT>
will be interleaved in the BDD variable order for this Datalog analysis.
See Section <A HREF="node11.html#sec:bdd-representation"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> for more details on BDD representations.

<P>
Each Datalog analysis rule is a Horn clause of the form
<TT>R(t) :- R1(t1), ..., Rn(tn)</TT>
meaning that if relations <TT>R1</TT>, ..., <TT>Rn</TT> contain tuples <TT>t1</TT>, ..., <TT>tn</TT>
respectively, then relation <TT>R</TT> contains tuple <TT>t</TT>.
A backslash may be used at the end of a line to break long rules for readability.
The Datalog analysis solver <TT>bddbddb</TT> used in Chord does not apply any
sophisticated optimizations to simplify the rules; besides the BDD variable order,
the manner in which these rules are expressed heavily affects the performance of
the solver.  For instance, an important manual optimization involves breaking down
long rules into multiple shorter rules communicating via intermediate relations.
See Section <A HREF="node10.html#sec:tuning-datalog-analysis"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A> for hints on tuning the performance
of Datalog analyses.

<HR>
<!--Navigation Panel-->
<A NAME="tex2html140"
  HREF="node10.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html138"
  HREF="user_guide.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html132"
  HREF="node8.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html141"
  HREF="node10.html">Tuning a Datalog Analysis</A>
<B> Up:</B> <A NAME="tex2html139"
  HREF="user_guide.html">Chord: A Static and</A>
<B> Previous:</B> <A NAME="tex2html133"
  HREF="node8.html">Instrumentation Events</A>
<!--End of Navigation Panel-->
<ADDRESS>
Mayur Naik
2010-08-13
</ADDRESS>
</BODY>
</HTML>
