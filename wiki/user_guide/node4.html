<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-1 (1.69)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>Computing Program Scope</TITLE>
<META NAME="description" CONTENT="Computing Program Scope">
<META NAME="keywords" CONTENT="user_guide">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="user_guide.css">

<LINK REL="next" HREF="node5.html">
<LINK REL="previous" HREF="node3.html">
<LINK REL="up" HREF="user_guide.html">
<LINK REL="next" HREF="node5.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html90"
  HREF="node5.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html88"
  HREF="user_guide.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html82"
  HREF="node3.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html91"
  HREF="node5.html">Running a Program Analysis</A>
<B> Up:</B> <A NAME="tex2html89"
  HREF="user_guide.html">Chord: A Static and</A>
<B> Previous:</B> <A NAME="tex2html83"
  HREF="node3.html">Setting up a Java</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION00040000000000000000"></A>
<A NAME="sec:building-scope"></A>
<BR>
Computing Program Scope
</H1>

<P>
Chord computes the scope (i.e., reachable methods) of the given program
either if property <TT>chord.build.scope</TT> is set to <TT>true</TT> or if some other task (e.g.,
a program analysis specified via property <TT>chord.run.analyses</TT>) demands it by
calling method <TT>chord.program.Program.getProgram()</TT>.

<P>
The algorithm used to compute program scope is as follows.

<P>

<UL>
<LI>If property <TT>chord.reuse.scope</TT> has value <TT>true</TT> and the file specified by property
<TT>chord.methods.file</TT> exists,
then Chord regards that file as specifying the methods to be deemed reachable.
The format of the methods file is an entry of the form <TT>&lt;mname&gt;:&lt;mdesc&gt;@&lt;cname&gt;</TT> per line,
specifying the method's name <TT>&lt;mname&gt;</TT>, the method's descriptor <TT>&lt;mdesc&gt;</TT>, and the
method's declaring class <TT>&lt;cname&gt;</TT>
(e.g., <TT>main:([Ljava/lang/String;)V@foo.bar.Main</TT>).

<P>
The default value of property <TT>chord.reuse.scope</TT> is <TT>false</TT>, and
that of property <TT>chord.methods.file</TT> is <TT>[chord.out.dir]/methods.txt</TT>.
where property <TT>chord.out.dir</TT> defaults to <TT>[chord.work.dir]/chord_output/</TT>,
and property <TT>chord.work.dir</TT> defaults to the current working directory.

<P>
</LI>
<LI>If property <TT>chord.reuse.scope</TT> has value <TT>false</TT> or the file specified by
property <TT>chord.methods.file</TT> does not exist, then Chord computes program scope
using the algorithm specified by property <TT>chord.scope.kind</TT> and
then writes the methods deemed reachable by that algorithm to that file.

<P>
The possible legal values of property <TT>chord.scope.kind</TT> are [<TT>dynamic</TT><IMG
 WIDTH="8" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\vert$"><TT>rta</TT><IMG
 WIDTH="8" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\vert$"><TT>cha</TT>].
In each case, Chord at least expects properties <TT>chord.main.class</TT> and <TT>chord.class.path</TT>
to be set.

<P>

<UL>
<LI>The <TT>dynamic</TT> value instructs Chord to compute program scope dynamically, by running the program
and observing using JVMTI the classes that are loaded at run-time.
The number of times the program is run and the command-line arguments to be supplied to
the program in each run is specified by properties <TT>chord.run.ids</TT> and
<TT>chord.args.&lt;id&gt;</TT> for each run ID <TT>&lt;id&gt;</TT>.  By default, the program is run only once, using run ID <TT>0</TT>,
and without any command-line arguments.
Only classes loaded in some run are regarded as reachable but <I>all</I> methods of each loaded class are regarded
as reachable regardless of whether they were invoked in the run.
The rationale behind this decision is to both reduce run-time overhead of JVMTI and to increase the
predictive power of program analyses performed using the computed program scope.

<P>
</LI>
<LI>The <TT>rta</TT> value instructs Chord to compute program scope statically using Rapid Type Analysis (RTA).

<P>
RTA is an iterative fixed-point algorithm.  It maintains a set of reachable methods <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$M$">.
The initial iteration starts by assuming that only the main method in the main class is reachable
(Chord also handles class initializer methods but we ignore them here for brevity; we also ignore
the set of reachable classes maintained besides the set of reachable methods).
All object allocation sites <IMG
 WIDTH="18" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$H$"> contained in methods in <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$M$"> are deemed
reachable (i.e., control-flow within method bodies is ignored).  Whenever a dynamically-dispatching
method call site (i.e., an invokevirtual or invokeinterface site) with receiver of static
type <IMG
 WIDTH="10" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img4.png"
 ALT="$t$"> is encountered in a method in <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$M$">, only subtypes of <IMG
 WIDTH="10" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img4.png"
 ALT="$t$"> whose objects are allocated at some site in <IMG
 WIDTH="18" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img3.png"
 ALT="$H$">
are considered to determine the possible target methods, and each such target
method is added to <IMG
 WIDTH="21" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img2.png"
 ALT="$M$">.  The process terminates when no more methods can be added.

<P>
</LI>
<LI>The <TT>cha</TT> value instructs Chord to compute program scope statically using Class Hierarchy Analysis (CHA).

<P>
The key difference between CHA and RTA is that for invokevirtual and invokeinterface sites with receiver of
static type <IMG
 WIDTH="10" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img4.png"
 ALT="$t$">, CHA considers <I>all</I> subtypes of <IMG
 WIDTH="10" HEIGHT="13" ALIGN="BOTTOM" BORDER="0"
 SRC="img4.png"
 ALT="$t$"> in the class hierarchy to determine the possible
target methods, whereas RTA restricts them to types of objects allocated in methods deemed reachable so far.
As a result, CHA is highly imprecise in practice, and also expensive since it grossly overestimates the set
of reachable classes and methods.
Nevertheless, Chord allows users to control which classes are included in the class hierarchy (see below)
and thereby control the precision and cost of CHA.

<P>
</LI>
</UL>
The default value of property <TT>chord.scope.kind</TT> is <TT>rta</TT>.
</LI>
</UL>

<P>
The class hierarchy is built if property <TT>chord.scope.kind</TT> has value <TT>cha</TT>.
Users can control which classes are included in building the class hierarchy by setting property <TT>chord.ch.kind</TT>,
whose possible legal values are [<TT>static</TT><IMG
 WIDTH="8" HEIGHT="32" ALIGN="MIDDLE" BORDER="0"
 SRC="img1.png"
 ALT="$\vert$"><TT>dynamic</TT>].
Chord first constructs the entire classpath of the given program by concatenating in order the following
classpaths:

<P>

<OL>
<LI>The boot classpath, specified by property <TT>sun.boot.class.path</TT>.
</LI>
<LI>The library extensions classpath, comprising all jar files in directory <TT>[java.home]/lib/dir/</TT>.
</LI>
<LI>Chord's classpath, specified by property <TT>chord.main.class.path</TT>.
This includes the classpath of any user-defined Java analyses, specified by user-defined property <TT>chord.java.analysis.path</TT>, which is empty by default.
</LI>
<LI>The classpath of the given program, specified by user-defined property <TT>chord.class.path</TT>, which is empty by default.
</LI>
</OL>

<P>
All classes in the entire classpath (resulting from items 1-4 above) are included in the class hierarchy
with the following exceptions:

<UL>
<LI>Duplicate classes, i.e., classes with the same name occurring in more than one classpath element;
in this case, all occurrences except the first are excluded. 
</LI>
<LI>All classes in Chord's classpath are excluded, i.e., all classes in the classpath specified by property <TT>chord.main.class.path</TT>,
such as those in packages and sub-packages of <TT>chord</TT>, <TT>joeq</TT>, <TT>net.sf.bddbddb</TT>, <TT>net.sf.javabdd</TT>, <TT>javassist</TT>, <TT>gnu.trove</TT>, etc.
</LI>
<LI>If property <TT>chord.ch.kind</TT> has value <TT>dynamic</TT>, then Chord runs the given program and
observes the set of all classes the JVM loads; any class not in this set is excluded.
By default, property <TT>chord.ch.kind</TT> has value <TT>static</TT>.
</LI>
<LI>If the superclass of a class C is missing or if an interface implemented/extended by a class/interface
C is missing, where ``missing" means that it is either not in the classpath resulting from items 1-4 above
or it is excluded by one of these rules, then C itself is excluded.  Note that this rule is recursive, e.g.,
if C has superclass B which in turn has superclass A, and A is missing, then both B and C are
excluded.
</LI>
</UL>

<P>

<HR>
<!--Navigation Panel-->
<A NAME="tex2html90"
  HREF="node5.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html88"
  HREF="user_guide.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html82"
  HREF="node3.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html91"
  HREF="node5.html">Running a Program Analysis</A>
<B> Up:</B> <A NAME="tex2html89"
  HREF="user_guide.html">Chord: A Static and</A>
<B> Previous:</B> <A NAME="tex2html83"
  HREF="node3.html">Setting up a Java</A>
<!--End of Navigation Panel-->
<ADDRESS>
Mayur Naik
2010-08-13
</ADDRESS>
</BODY>
</HTML>
